{% extends 'base.html' %}

{% load cache gravatar_tags humanize %}

{% block content %}

    <section class="content landing">
        <p>
            Dbpatterns is a service that allows you to create, share, explore
            database models on the web.
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://dbpatterns.com">Tweet</a>
        </p>
    </section>

    <div class="dashboard">
    <section class="content" id="timeline">
    <h2>Public Newsfeed</h2>
        <div class="stripe">
            <div class="newsfeed">
            {% for entry in newsfeed %}
            <section class="entry {{ entry.news_type }}">
                <aside>
                <a class="gravatar" href="{% url auth_profile entry.user.username %}">
                    <img alt="gravatar of {{ document.user }}" src="{% gravatar_for_email entry.user.email %}">
                </a>
                </aside>
                <article>
                    {% if entry.news_type == "registration" %}
                        <h3><a href="{% url auth_profile entry.user.username %}">{{ entry.user.username }}</a> joined to dbpatterns</h3>
                    {% elif entry.news_type == "document" %}
                        <h3>{{ entry.user.username }} created new <a href="{{ entry.related_object.get_absolute_url }}">pattern</a></h3>
                        <h4><a href="{{ entry.related_object.get_absolute_url }}">{{ entry.related_object.title }}</a></h4>

                        {% with entry.related_object as document %}
                            {% include "documents/preview.html" %}
                        {% endwith %}


                    {% elif entry.news_type == "fork" %}
                        <h3>{{ entry.user.username }} forked a pattern</h3>
                        <h4><a href="{{ entry.related_object.get_absolute_url }}">{{ entry.related_object.title }}</a></h4>

                        {% with entry.related_object as document %}
                            {% include "documents/preview.html" %}
                        {% endwith %}

                    {% elif entry.news_type == "comment" %}
                        <h3><a href="{% url auth_profile entry.user.username %}">{{ entry.user.username }}</a> commented on a <a href="{{ entry.related_object.document.get_absolute_url }}">pattern</a></h3>
                        <blockquote>{{ entry.related_object.body }}</blockquote>
                    {% endif %}
                    <time><a href="{{ entry.related_object.get_absolute_url }}">{{ entry.date_created|naturaltime }}</a></time>
                </article>
            </section>
            {% endfor %}
            <div class="clearfix"></div>
        </div>
        </div>
    </section>
    </div>

{% endblock %}

{% block footer %}
    <footer>
        dbpatterns is an open-source project. you can contribute on
        <a href="http://github.com/fatiherikli/dbpatterns">github</a>.
    </footer>
{% endblock %}

{% block scripts %}
{{ block.super }}
    <!-- twitter share button -->
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
{% endblock %}

